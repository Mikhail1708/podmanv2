<!DOCTYPE html>
<html>
<head>
    <title>Покупка билета</title>
</head>
<body>
    <h1>Покупка билета</h1>
    <form method="post">
        {% csrf_token %}

        <!-- Выбор фильма -->
        <label for="film">Фильм:</label>
        <select name="film" id="film" required>
            <option value="">-- Выберите фильм --</option>
            {% for film in films %}
                <option value="{{ film.id }}">{{ film.title }}</option>
            {% endfor %}
        </select>
        <br><br>

        <!-- Выбор сеанса (будет фильтроваться JS-ом, если нужно) -->
        <label for="session">Сеанс:</label>
        <select name="session" id="session" required>
            <option value="">-- Выберите сеанс --</option>
            {% for film in films %}
                {% for session in film.sessions.all %}
                    <option value="{{ session.id }}" data-film="{{ film.id }}">
                        {{ session.date }} {{ session.time }}
                    </option>
                {% endfor %}
            {% endfor %}
        </select>
        <br><br>

        <!-- Остальные поля формы (ряд, место, имя) -->
        {{ form.row.label_tag }} {{ form.row }}
        {{ form.seat.label_tag }} {{ form.seat }}
        {{ form.name.label_tag }} {{ form.name }}

        <br>
        <button type="submit">Купить</button>
    </form>

    <script>
    // Пример фильтрации сеансов по выбранному фильму (опционально)
    document.getElementById('film').addEventListener('change', function() {
        var filmId = this.value;
        var sessionSelect = document.getElementById('session');
        for (var i = 0; i < sessionSelect.options.length; i++) {
            var opt = sessionSelect.options[i];
            if (!opt.value) continue;
            opt.style.display = (opt.getAttribute('data-film') === filmId) ? '' : 'none';
        }
        sessionSelect.value = '';
    });
    </script>
</body>
</html>